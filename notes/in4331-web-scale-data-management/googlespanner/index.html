<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Spanner provides a unique feature of providing distributed transactions without locks, through the property of Spanner that distributed transactions are externally consistent. Instead of locking the database for reads to get the data (all writes are locked), it works by generating a snapshot of the database from which the reads happen (writes can then still happen on the original database), however now snapshots need to be synchronized across the distributed shards of the database."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://nicktehrany.github.io/notes/in4331-web-scale-data-management/googlespanner/><title>Google Spanner: Google's Globally Distributed Database</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><meta itemprop=name content="Google Spanner: Google's Globally Distributed Database"><meta itemprop=description content="Spanner provides a unique feature of providing distributed transactions without locks, through the property of Spanner that distributed transactions are externally consistent. Instead of locking the database for reads to get the data (all writes are locked), it works by generating a snapshot of the database from which the reads happen (writes can then still happen on the original database), however now snapshots need to be synchronized across the distributed shards of the database."><meta itemprop=datePublished content="2021-06-09T14:52:13+02:00"><meta itemprop=dateModified content="2021-06-09T14:52:13+02:00"><meta itemprop=wordCount content="257"><meta itemprop=image content="https://nicktehrany.github.io"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nicktehrany.github.io"><meta name=twitter:title content="Google Spanner: Google's Globally Distributed Database"><meta name=twitter:description content="Spanner provides a unique feature of providing distributed transactions without locks, through the property of Spanner that distributed transactions are externally consistent. Instead of locking the database for reads to get the data (all writes are locked), it works by generating a snapshot of the database from which the reads happen (writes can then still happen on the original database), however now snapshots need to be synchronized across the distributed shards of the database."><meta property="og:title" content="Google Spanner: Google's Globally Distributed Database"><meta property="og:description" content="Spanner provides a unique feature of providing distributed transactions without locks, through the property of Spanner that distributed transactions are externally consistent. Instead of locking the database for reads to get the data (all writes are locked), it works by generating a snapshot of the database from which the reads happen (writes can then still happen on the original database), however now snapshots need to be synchronized across the distributed shards of the database."><meta property="og:type" content="article"><meta property="og:url" content="https://nicktehrany.github.io/notes/in4331-web-scale-data-management/googlespanner/"><meta property="og:image" content="https://nicktehrany.github.io"><meta property="article:published_time" content="2021-06-09T14:52:13+02:00"><meta property="article:modified_time" content="2021-06-09T14:52:13+02:00"><meta property="og:site_name" content="Nick Tehrany"><meta property="article:published_time" content="2021-06-09 14:52:13 +0200 +0200"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>cd nicktehrany</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/awards>Awards</a></li><li><a href=/publications>Publications</a></li><li><a href=/projects>Projects</a></li><li><a href=/posts>Blog</a></li><li><a href=/notes>Uni Notes</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=posts><div class=post-info><p></p></div><article><h1 class=post-title><a href=https://nicktehrany.github.io/notes/in4331-web-scale-data-management/googlespanner/>Google Spanner: Google&rsquo;s Globally Distributed Database</a></h1><div class=post-content><p>Spanner provides a unique feature of providing distributed transactions without locks, through the property of Spanner
that distributed transactions are externally consistent. Instead of locking the database for reads to get the data (all
writes are locked), it works by generating a snapshot of the database from which the reads happen (writes can then still
happen on the original database), however now snapshots need to be synchronized across the distributed shards of the
database. Additionally, it uses transactions with strict 2PL (2 phase locking), where each transaction $T$ gets a
timestamp $s$ and data written by transaction $T$ is then timestamped with $s$.</p><h3 id=synchronized-snapshots>Synchronized Snapshots</h3><p>In order to provide synchronized snapshots, Spanner needs to have some notion of a global clock, which it achieves
through external consistency. This is the property of the commit order respecting the global time order. For achieving
this, timestamp order is used as the commit order (timestamp_order == commit_order). For generating a timestamp, it
uses TrueTime.</p><h3 id=truetime>TrueTime</h3><p>Presents a global time with a bounded uncertainty given <code>TT.now()</code> is given in a window with an <code>earliest</code> and
<code>lastest</code> time which falls in the interval of $2*\varepsilon$. Then picking a time <code>TT.now().latest</code> which is an upper
bound on time in the future gives that timestamp $s$ falls within the interval of the releasing of locks. This is done
by waiting out the uncertainty in clocks (waiting for actual releasing of clocks), called the *commit wait*, which in
turn is done by waiting until <code>TT.now().earliest</code> > $s$. Therefore the average commit wait is roughly $2*\varepsilon$.</p><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};window.addEventListener('load',(event)=>{document.querySelectorAll("mjx-container").forEach(function(x){x.parentElement.classList+='has-jax'})});</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>257 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-06-09</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://nicktehrany.github.io/notes/in4331-web-scale-data-management/deterministic-dbs/><span class=button__icon>←</span>
<span class=button__text>Deterministic DBs</span></a></span>
<span class="button next"><a href=https://nicktehrany.github.io/notes/in4331-web-scale-data-management/paxosmegastore/><span class=button__text>Paxos Megastore</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css><div><div>&nbsp; <a href=https://github.com/nicktehrany target=_blank rel=noopener title=Github><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>&nbsp;&nbsp; <a href=https://www.linkedin.com/in/nicktehrany/ target=_blank rel=noopener title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a>&nbsp;
<a href=/misc/cv.pdf target=_self><i class="ai ai-cv ai-2x"></i></a><a href=https://www.semanticscholar.org/author/Tehrany/2105151990 target=_self><i class="ai ai-semantic-scholar ai-2x"></i></a></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Themed by <a href=https://github.com/rhazdon/hugo-theme-hello-friend-ng>Hello Friend NG</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.af435e44374f1e99a669ea8cd5bb9a2fceed80588941a451bfddb66b86a67c9f40b0f417e9543a763f809aa7e9300d7b1d69bf99615810ba02ac70396d50fad5.js integrity="sha512-r0NeRDdPHpmmaeqM1buaL87tgFiJQaRRv922a4amfJ9AsPQX6VQ6dj+AmqfpMA17HWm/mWFYELoCrHA5bVD61Q=="></script></body></html>