<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content>
<meta name=description content="IN4191 Security and Cryptography Notes">
<meta name=keywords content>
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=https://nicktehrany.github.io/notes/in4191-security-and-cryptography-notes/lecture-7/>
<title>
Lecture 7: Hash Functions, MAC, and Key Derivation Functions
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=/main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css>
<meta itemprop=name content="Lecture 7: Hash Functions, MAC, and Key Derivation Functions">
<meta itemprop=description content="IN4191 Security and Cryptography Notes"><meta itemprop=datePublished content="2021-01-11T00:00:00+00:00">
<meta itemprop=dateModified content="2021-01-11T00:00:00+00:00">
<meta itemprop=wordCount content="1016"><meta itemprop=image content="https://nicktehrany.github.io">
<meta itemprop=keywords content>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://nicktehrany.github.io">
<meta name=twitter:title content="Lecture 7: Hash Functions, MAC, and Key Derivation Functions">
<meta name=twitter:description content="IN4191 Security and Cryptography Notes">
<meta property="og:title" content="Lecture 7: Hash Functions, MAC, and Key Derivation Functions">
<meta property="og:description" content="IN4191 Security and Cryptography Notes">
<meta property="og:type" content="article">
<meta property="og:url" content="https://nicktehrany.github.io/notes/in4191-security-and-cryptography-notes/lecture-7/"><meta property="og:image" content="https://nicktehrany.github.io"><meta property="article:section" content="notes">
<meta property="article:published_time" content="2021-01-11T00:00:00+00:00">
<meta property="article:modified_time" content="2021-01-11T00:00:00+00:00"><meta property="og:site_name" content="Nick Tehrany">
<meta property="article:published_time" content="2021-01-11 00:00:00 +0000 UTC">
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>$</span>
<span class=logo__text>cd nicktehrany</span>
<span class=logo__cursor>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=/awards>Awards</a></li><li><a href=/publications>Publications</a></li><li><a href=/projects>Projects</a></li><li><a href=/notes>Uni Notes</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<main class=posts>
<div class=post-info>
<p>
</p>
</div>
<article>
<h1 class=post-title>
<a href=https://nicktehrany.github.io/notes/in4191-security-and-cryptography-notes/lecture-7/>Lecture 7: Hash Functions, MAC, and Key Derivation Functions</a>
</h1>
<div class=post-content>
<h2 id=hash-functions-mac-and-key-derivation-functions-chapter-14>Hash Functions, MAC, and Key Derivation Functions (Chapter 14)</h2>
<p>Hash functions are used for integrity protection (checksum, file system integrity like Bit-torrent), one way encryption (password protection), asymmetric crypto schemes, MACs, key derivations, pseudo random number generators, and many more applications.</p>
<p>Hash functions receive an arbitrary length bit string and output a fixed length string called the hash value, digest, fingerprint, or hashcode.
Hash functions are one way: easy to compute $y$ given $x$, where $y: H: \{0-1\}*\rightarrow\{0-1\}^n$</p>
<p>$$H(x)=y$$</p>
<p>and $x$ is called the preimage.</p>
<p>Need to have three properties:</p>
<ol>
<li><strong>Preimage Resistance:</strong> given a hash value $y$, it should be infeasible to find $x$.</li>
<li><strong>Second Preimage Resistance:</strong> given a preimage $x$, it should be hard to find an $x'$ with the same hash such that $y=y'$. This is done by making the output space large enough (i.e. $2^{128}$), since $2^n$ attempts are required.</li>
<li><strong>Collision Resistance:</strong> given two preimages $x$ and $x'$ it should be infeasible to compute the same hash $y$. The difference to second preimage resistance is that here we are not looking for a single pair of preimages that give the same hash, but any pair (remember all your previous hash calculations).</li>
</ol>
<p>As there is guaranteed to exist an adversary that can break collision resistance, since we know a larger input domain will have to map multiple inputs to the same output if the output domain is fixed (pigenhole principle applies), but given human ignorance we can assume hash functions to be collision resistant. Human ignorance states that in the same domain the collision will likely be a meaningless preimage. For example trying to find the collision of a hashed contract will just be random bits.</p>
<p>Definition: A function is said to be collision resistant (by human ignorance) or HI-CR secure if it is believed to be infeasible to write down a collision for the function, i.e. two elements in the domain mapping to the same element in the codomain.</p>
<p>Terminology:</p>
<ul>
<li><strong>one way:</strong> preimage + second preimage resistant
<ul>
<li>sometimes only preimage resistant</li>
</ul>
</li>
<li><strong>weak collision resistant:</strong> second preimage resistant</li>
<li><strong>strong collision resistant:</strong> collision resistant</li>
<li><strong>OWHF (One way hash function):</strong> preimage and second preimage resistant</li>
<li><strong>CRHF (collision resistant hash function):</strong> second preimage and collision resistant</li>
</ul>
<h3 id=padding>Padding</h3>
<p>The input to a compression function needs to be a multiple of the block size, which requires to add padding bits such that</p>
<p>$$m||pad_i(|m|,b)$$</p>
<p>There are 5 main padding methods of which method 0 is not secure.</p>
<ol>
<li><strong>Method 0:</strong> Let $v$ denote $b−|m|(\text{ mod } b)$. Add $v$ zeros to the end of the message $|m|$, i.e. $m‖pad_0(|m|,b)=m‖0∗$.</li>
<li><strong>Method 1:</strong> Let $v$ denote $b−(|m|+1) (\text{ mod }b)$. Append a single 1 bit to the message, and then pad with $v$ zeros, i.e. $m‖pad_1(|m|,b)=m‖10∗$.</li>
<li><strong>Method 2:</strong> Let $v$ denote $b−(|m|+ 65) (\text{ mod }b)$. Encode $|m|$ as a 64-bit integer $l$. Append a single 1 bit to the message, and then pad with $v$ zeros, and then append the 64-bit integer $l$, i.e. $m‖pad_2(|m|,b)=m‖10∗‖l$.</li>
<li><strong>Method 3:</strong> Let $v$ denote $b−(|m|+ 64) (\text{ mod } b)$. Encode $|m|$ as a 64-bit integer $l$.Pad with $v$ zeros, and then append the 64-bit integer $l$, i.e. $m‖pad_3(|m|,b)=m‖0∗‖l$.</li>
<li><strong>Method 4:</strong> Let $v$ denote $b−(|m|+2) (\text{ mod }b)$. Append a single 1 bit to the message, and then pad with $v$ zeros, and then add a one-bit, i.e. $m‖pad_4(|m|,b)=m‖10∗1$.</li>
</ol>
<h3 id=merkle-damgard-construction>Merkle-Damgard Construction</h3>
<p><strong>Compression function:</strong> A hash function that receives a fixed length input.</p>
<p><img src=/images/IN4191/MD.png alt=MD></p>
<p>Its construction is based on a family of compression functions $f_k$ that map $(l+n)$ bit inputs to $n$ bit outputs.</p>
<p><img src=/images/IN4191/MD_Alg.png alt="MD Algorithm"></p>
<p>Conventionally MD algorithms use padding method 2.</p>
<h3 id=md-4-family>MD-4 Family</h3>
<p>The main algorithms in the MD-4 family, which are based on the MD construction are:</p>
<ul>
<li><strong>MD-4:</strong> The function $f$ has 3 rounds of 16 steps and an output bit length of 128 bits.</li>
<li><strong>MD-5:</strong> The function $f$ has 4 rounds of 16 steps and an output bit length of 128 bits.</li>
<li><strong>SHA-1:</strong> The function $f$ has 4 rounds of 20 steps and an output bit length of 160 bits.</li>
<li><strong>RIPEMD-160:</strong> The function $f$ has 5 rounds of 16 steps and an output bit length of 160 bits.</li>
<li><strong>SHA-2:</strong>
<ul>
<li><strong>SHA-256:</strong> The function $f$ has 64 rounds of single steps and an output bit length of 256 bits.</li>
<li><strong>SHA-384:</strong> The function $f$ is identical to SHA-512 except the output is truncated to 384 bits, and the initial chaining valueHis different.</li>
<li><strong>SHA-512:</strong> The function $f$ has 80 rounds of single steps and an output bit length of 512 bits.</li>
</ul>
</li>
</ul>
<p>Due to birthdaying, the collision space to find a collision in MD-4 becomes $2^{1/2n}$</p>
<h4 id=birthdaying-paradox>Birthdaying Paradox</h4>
<p>Given a set of $t$ $(\ge 10)$ elements, take a sample of size $k$ (drawn with repetition) in oder to get probability $\ge 1/2$ on a collision (i.e. an element drawn at least twice). $k$ has to be $\ge 1.2 \sqrt{t}$</p>
<p>Therefore if $F:A\rightarrow B$ (function $F$ is a mapping from $A$ to $B$) is a random function and $\text{sizeof }A&#187;\text{sizeof }B$ (size of $A$ is huge compared to $B$) then one can expect a collision after about $\sqrt{(\text{sizeof }B)}$ random function calls.</p>
<h3 id=hmac>HMAC</h3>
<p>Have a keyed hash from an unkeyed hash function. Trivially this can be done by concatenating the message with the key and then hashing all of it</p>
<p>$$t=H(k||m||pad_i(|k|+|m|,b))$$</p>
<p>but this is not safe as the adversary can construct new valid hashes based on the previous hashes, without knowing the key.</p>
<p>Used a nested MAC (<strong>NMAC</strong>), that is built from two keyed hashes</p>
<p>$$\text{NMAC}<em>{k1,k2}(m)=F</em>{k_1}(G_{k_2}(m))$$</p>
<p>$$F_{k_1}(x)=f((x||pad_2(l+|x|,l))||k_1)=\text{MD}[f,k_1]^*(x)$$</p>
<p>$$G_{k_2}(m)=\text{MD}[f,k_2]^*(m)$$</p>
<p>then we have</p>
<p>$$\text{NMAC}_{k_1,k_2}(m)=\text{MD}[f,k_1]<em>(\text{MD}[f,k_2]^</em>(m))$$</p>
<p>We can then construct the function HMAC using NMAC as follows</p>
<p>$$\displaylines{\text{HMAC}_k(m)=H((k\oplus opad)||H((k\oplus ipad)||m))\<br>
=\text{MD}[f,IV]((k\oplus opad)||\text{MD}[f,IV]((k\oplus ipad)||m))}$$</p>
<p>with $opad$ and $ipad$ being fixed $l$ bit padding values.</p>
<h4 id=mac-from-a-block-cipher>MAC from a Block Cipher</h4>
<p>We can use a cipher block chaining mode on MAC in the following way</p>
<p><img src=/images/IN4191/CBC-MAC.png alt="CBC MAC"></p>
<p>With this we can then double encrypt with a second key as follows</p>
<p>$$\text{EMAC}<em>{k_1,k_2}(m)=e</em>{k_2}(CBC-MAC_{k_1}(m))$$</p>
<h3 id=sponge-construction>Sponge Construction</h3>
<p>The construction absorbs the message and when output is required it is squeezed from the construction. The permutation function is a fixed function (not one way).</p>
<p><img src=/images/IN4191/Sponge.png alt="Sponge Construction"></p>
<p>Using this sponge construction <strong>IND-CCA secure</strong> encryption and decryption can also be done, or sponge based MACs and sponge based stream ciphers.</p>
<p><img src=/images/IN4191/IND-CCA-Sponge.png alt="IND-CCA Secure Sponge"></p>
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}},window.addEventListener('load',a=>{document.querySelectorAll("mjx-container").forEach(function(a){a.parentElement.classList+='has-jax'})})</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
</div>
</article>
<hr>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
1016 Words
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2021-01-11
</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://nicktehrany.github.io/notes/in4191-security-and-cryptography-notes/lecture-8/>
<span class=button__icon>←</span>
<span class=button__text>Lecture 8: Number Theory and Elliptic Curves</span>
</a>
</span>
<span class="button next">
<a href=https://nicktehrany.github.io/notes/in4191-security-and-cryptography-notes/lecture-6/>
<span class=button__text>Lecture 6: Block Ciphers and Modes of Operation</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</main>
</div>
<footer class=footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css>
<div>
<div>
&nbsp; <a href=https://github.com/nicktehrany target=_blank rel=noopener title=Github><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a> &nbsp;&nbsp; <a href=https://www.linkedin.com/in/nicktehrany/ target=_blank rel=noopener title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a> &nbsp;
<a href=https://www.semanticscholar.org/author/Tehrany/2105151990 target=_self><i class="ai ai-semantic-scholar ai-2x"></i></a>
</div>
</div>
<div class=footer__inner>
<div class=footer__content>
<span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Themed by <a href=https://github.com/rhazdon/hugo-theme-hello-friend-ng>Hello Friend NG</a></span>
</div>
</div>
</footer>
</div>
<script type=text/javascript src=/bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script>
</body>
</html>