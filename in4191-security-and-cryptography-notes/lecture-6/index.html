<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="IN4191 Security and Cryptography Notes" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://nicktehrany.github.io/in4191-security-and-cryptography-notes/lecture-6/" />


    <title>
        
            Lecture 6: Block Ciphers and Modes of Operation :: Nick Tehrany 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.9655fd5f70c904b04634d3d3e59f77a994f4471ec393982efe724d829b71f6e7.css">







<meta itemprop="name" content="Lecture 6: Block Ciphers and Modes of Operation">
<meta itemprop="description" content="IN4191 Security and Cryptography Notes">


<meta itemprop="datePublished" content="2021-01-10T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-01-10T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1609">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://nicktehrany.github.io"/>

<meta name="twitter:title" content="Lecture 6: Block Ciphers and Modes of Operation"/>
<meta name="twitter:description" content="IN4191 Security and Cryptography Notes"/>




    <meta property="og:title" content="Lecture 6: Block Ciphers and Modes of Operation" />
<meta property="og:description" content="IN4191 Security and Cryptography Notes" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nicktehrany.github.io/in4191-security-and-cryptography-notes/lecture-6/" />

<meta property="og:image" content="https://nicktehrany.github.io" />
<meta property="article:published_time" content="2021-01-10T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2021-01-10T00:00:00&#43;00:00"/><meta property="og:site_name" content="Nick Tehrany" />






    <meta property="article:published_time" content="2021-01-10 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body class="dark-theme">
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">$</span>
            <span class="logo__text">cd nicktehrany</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>

        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/projects">Projects</a></li><li><a href="/publications">Publications</a></li><li><a href="/thesis">Thesis</a></li><li><a href="/notes">Uni Notes</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
<main class="posts">
  
  <div class="post-info">
    <p>
      
      
    </p>
  </div>
  
  <article>
    <h1 class="post-title">
      <a href="https://nicktehrany.github.io/in4191-security-and-cryptography-notes/lecture-6/">Lecture 6: Block Ciphers and Modes of Operation</a>
    </h1>
    
      
      
      <div class="post-content">
        <h4 id="block-ciphers-and-modes-of-operation-chapter-13">Block Ciphers and Modes of Operation (Chapter 13)</h4>

<p>Block ciphers operate on blocks of plaintext at a time to produce blocks of ciphertext. Block sizes tend to be large, 64 bits in DES and 128 bits in other modern block ciphers. In order to limit the advantage of the adversary, the key space is kept very large such that $Adv_{{F_k}K}^{PRP}(A)\approx 1/|K|$.
Block cipher is part of an encryption but requires a mode of operation, these are both developed independently.</p>

<p>DES (Data Encryption Standard) was an <em>iterated</em> block cipher which uses a <em>round function</em> repeatedly. DES was deemed unsafe in the 90s but other variants (3DES, shown below) are still being used. Another such cipher is AES (Advanced Encryption Standard). The round function takes a block and returns a block of the same size, and the number of rounds can be fixed or varied. Each use of the round function uses a round key derived from the main secret key using an algorithm called <em>key scheduling</em>. The round function should be invertible for decryption and using round keys in reverse order.</p>

<p><figure><img src="/images/IN4191/3DES.png" alt="3DES"></figure></p>

<p>In DES the round is invertible but not the round function.</p>

<p>In AES both the round and the round function are invertible.</p>

<p>Techniques (+Luck) for breaking block ciphers:</p>

<ul>
<li><strong>Differential Cryptanalysis:</strong> looking at the ciphertext pairs where the plaintexts have certain differences. For breaking DES it requires $2^{37}$ in time and $2^{47}$ in memory.</li>
<li><strong>Linear Cryptanalysis:</strong> approximate the behavior of non-linear components of the block cipher with linear functions. For breaking DES it requires $2^{43}$ plaintexts.</li>
</ul>

<p>Shannon's confusion-diffusion paradigm</p>

<ul>
<li><strong>Confusion:</strong> Split the block into smaller blocks and apply a permutation on each block</li>
<li><strong>Diffusion:</strong> Mix permutations so that local change can effect the whole block</li>
</ul>

<p><strong>Substitution-permutation networks</strong> are a direct implementation of Shannon's paradigm by mixing keys, substituting, and permutation.</p>

<p><em>Avalanche effect</em> states that a single change in the plaintext must affect every bit of the output, to not find correlations between input bits and output bits. In order to have avalanche effect there need to be at least 7 rounds.</p>

<h4 id="feistel-cipher">Feistel Cipher</h4>

<p>Round functions are invertible regardless of the choice of the function and works by switching right and left block and applying a function on the right with the key and xor it the left block for a new right block. The functions for encryption are</p>

<p><span  class="math">\[\displaylines{L_i\leftarrow R_{i-1},\\R_i\leftarrow L_{i-1}\oplus F(K_i,R_{i-1})}\]</span></p>

<p>and decryption is done as</p>

<p><span  class="math">\[\displaylines{R_{i-1}\leftarrow L_i,\\L_{i-1}\leftarrow R_i\oplus F(K_i,L_i)}\]</span></p>

<p>and the operations visually</p>

<p><figure><img src="/images/IN4191/Feistel.png" alt="Feistel Cipher"></figure></p>

<p>Security of Feistel ciphers depends on:</p>

<ul>
<li>the round keys (are they random looking, secure enough)</li>
<li>the number of rounds</li>
<li>security of function $F$</li>
</ul>

<h4 id="des-data-encryption-standard">DES (Data Encryption Standard)</h4>

<p>A Feistel cipher with <strong>16 rounds</strong>, <strong>64 bits block size</strong>, <strong>56 bit key length</strong>, and <strong>16 round keys, each 48 bits</strong>. It performs an initial permutation (IP), then runs the Feistel cipher, and then perform a reverse permutation ($IP^{-1}$).</p>

<p><figure><img src="/images/IN4191/DES.png" alt="DES"></figure></p>

<p>The 3DES version uses three different keys and runs DES 3 times.</p>

<p>The stages of the $F$ function are:</p>

<ol>
<li><strong>Expansion permutation</strong> where the right half of the 32 bits is expanded and permuted to 48 bits.</li>
<li><strong>Round key addition</strong> where the 48 bit input is xored with the round key</li>
<li><strong>Splitting</strong> the resulting 48 bits are split into eight lots of 6 bit values.</li>
<li><strong>S-Boxes</strong> each 6 bit value goes into an s-box and produces a 4 bit output. S-boxes present the non-linear component, as they are lookup tables that are 4x16 in size.</li>
<li><strong>P-Box</strong> the eight 4 bit lots are combined into 32 bits and are permuted.</li>
</ol>

<p>DES key scheduling takes the 56 bit key (it's 64 bits but 8 bits are parity bits for error detection at every 8th bit, so 8 16 ... 64) and permutes the bits with the PC-1 permutation. The output of the permutation is divided into two 28 bit halfs $C_0$ the left half and $D_0$ the right. Each round we compute</p>

<p><span  class="math">\[C_i\leftarrow C_{i-1}\lll p_i,\]</span></p>

<p><span  class="math">\[D_i\leftarrow D_{i-1}\lll p_i\]</span></p>

<p>where $x \lll p_i$ means performing a cyclic shift on $x$ to the left by $p_i$ positions. If the round number is 1,2,9,16 we shift left by one position, otherwise by two. The two halfs $C_0$ and $D_0$ are joined back together and are permuted again with the PC-2 permutation. Visually depicted below</p>

<p><figure><img src="/images/IN4191/DES_key_sched.png" alt="DES Key Scheduling"></figure></p>

<p>Decryption is identical only keys will be used in reverse order.</p>

<h4 id="aes-advanced-encryption-standard">AES (Advanced Encryption Standard)</h4>

<p>AES is not a Feistel cipher but still has a round function. It is built on the mathematical foundation of finite fields (Galois fields). Galois fields are represented as $GF(p^m)$ with $p$ a prime number and $m$ an integer. Fields with value $m=1$ are prime fields and fields with $m\ge2$ are extension fields. Extension fields work with polynomials (have operations of addition, subtraction, multiplication, and non-negative exponentiation). Operations in the fields are in mod $p$ such that</p>

<p><span  class="math">\[a+b\equiv c \text{ mod } p\]</span></p>

<p>and</p>

<p><span  class="math">\[a*b\equiv c \text{ mod }p\]</span></p>

<p>and inverses are given as</p>

<p><span  class="math">\[a*a^{-1}\equiv 1 \text{ mod }p\]</span></p>

<p>where all variables come from the range of values in the set (e.g. $\mathbb{Z}_7=\{0,1,2,3,4,5,6\}$). Extension fields are represented in $m-1$ degree, for example with $GF(2^3)=GF(8)$ and is represented as</p>

<p><span  class="math">\[A(x)=a_2x^2+a_1x^1+a_0\]</span></p>

<p>shown with three different values for the coefficients (that can only be 0 or 1) as $(a_2,a_1,a_0)$. Then constructing all possible values for the coefficients we get the values for the field</p>

<p><span  class="math">\[GF(8)=\\{0,1,x,x+1,x^2,x^2+1,x^2+x,x^2+x+1\\}\]</span></p>

<p>Operations are still in mod $p$, such that for example in $GF(8)$ will be</p>

<p><span  class="math">\[(x^2+x)+(x^2+x+1)=((1+1)x^2+(1+1)x+1)\text{ mod }2=1\]</span></p>

<p>Operations subtraction and addition in the galois field of 2 $GF(2)$ are the same and are the same as doing an xor of the coefficients. For mutiplication with fields of degree larger than 2, to reduce the function to the original form</p>

<p><span  class="math">\[GF(x)=a_nx^n+a_{n-1}x^{n-1}+...+a_0\]</span></p>

<p>using an irreducible polynomial of degree $m-1$ with $m$ the degree of the multiplication result.</p>

<p>AES arithmetic is performed in modulo irreducible polynomial</p>

<p><span  class="math">\[m(x)=x^8+x^4+x^3+x+1\]</span></p>

<p>with 32-bit words with polynomial $F_{2^8}[X]$ of degree less than 4, such that</p>

<p><span  class="math">\[\displaylines{a_0||a_1||a_2||a_3\\a_3*x^3+a_2*x^2+a_1*x^1+a_0}\]</span></p>

<p>note the order of the coefficients is reversed to what they appear (using big-endian). Arithmetic on polynomials in $F_{2^8}[X]$ are modulo reducible polynomial $m(x)=x^4+1$, hence this is a ring rather than a field.</p>

<p>AES supports 128, 192, 256 bit blocks with respective keys 128, 192, and 256 bits. Block size 128 has 10 rounds, 192 has 12 rounds, and 256 has 14 rounds (add 2 per increase).</p>

<p>AES operates on a 4x4 matrix called the <em>state matrix</em>, keys are also held in a 4x4 matrix.</p>

<p>AES Operations:</p>

<ul>
<li><strong>SubBytes:</strong> two types of S-boxes exist in AES, one for encryption and one for decryption (one being the inverse of the other). Each byte of the state matrix is considered as an input into the S-Box.</li>
<li><strong>ShiftRows:</strong> performs a cyclic shift on the state matrix, where each row is shifted by a different offset.</li>

<li><p><strong>MixColumns:</strong> each column in the state matrix is taken in turn and a new colum is produced by applying it to the polynomial
<figure><img src="/images/IN4191/AES_MixColumns.png" alt="AES MixColumns"></figure></p></li>

<li><p><strong>AddRoundKey:</strong> the state matrix is xored with ($\oplus$) with the round key.</p></li>
</ul>

<p>AES can then be described with the following algorithms for encryption and decryption respectively</p>

<p><figure><img src="/images/IN4191/AES_encrypt.png" alt="AES Encrypt"></figure></p>

<p><figure><img src="/images/IN4191/AES_decrypt.png" alt="AES Decrypt"></figure></p>

<p>The round keys are computed from the main key, where each round key is a 32 bit word,  with substitution and permutation as follows</p>

<p><figure><img src="/images/IN4191/AES_KeySched.png" alt="AES Key Schedule"></figure></p>

<h4 id="modes-of-operation">Modes Of Operation</h4>

<p>Block ciphers are needed but as is they cannot be used in practice because of missing security notions (IND-CPA and IND-CCA).</p>

<p>There are many different operations but these are the 5 mainly used ones:</p>

<ul>
<li><p><strong>Electronic Code Book Mode (ECB):</strong> simplest operation that divides the message into blocks and encrypts them individually.
<figure><img src="/images/IN4191/ECB.png" alt="ECB Operations"></figure>
The problems with this mode are that the same input block will result in the same output block (repetitions in english text), deletion is possible without detection, and replay attack is possible (insert blocks from other messages). This means it is <strong>not IND-PASS</strong> secure and <strong>not OW-CCA</strong> secure but <strong>is OW-CPA</strong> secure.</p></li>

<li><p><strong>Cipher Block Chaining (CBC):</strong> encrypt the message by xoring the ciphertext after encryption with the ciphertext of the previous message (IV for the first message).
<figure><img src="/images/IN4191/CBC.png" alt="CBC Operations"></figure>
The problem with this mode is that it is sequential and cannot be parallelized, and single bit errors cause the whole block to be decrypted wrong and a single wrong bit in the next block. If IV is used once and never repeated it <strong>is IND-PASS</strong> secure, if IV is fixed it is deterministic and hence only <strong>IND-PASS</strong> secure and <strong>not CPA</strong> secure. A truly random IV <strong>is IND-CPA</strong> secure.</p></li>

<li><p><strong>Output Feedback Mode (OFB):</strong> a block cipher that can be used as stream cipher.
<figure><img src="/images/IN4191/OFB.png" alt="OFB Operations"></figure>
with a fixed IV it is <strong>not IND-CPA</strong> secure and <strong>not OW-CPA</strong> secure. With a nonce it <strong>is IND-CPA</strong> secure.</p></li>

<li><p><strong>Cipher Feedback Mode (CFB):</strong> also a block cipher that can be used a stream cipher, but here the keystream output is generated by encrypting the ciphertext.
<figure><img src="/images/IN4191/CFB.png" alt="CFB Operations"></figure>
with a nonce it is <strong>not IND-CPA</strong> secure but <strong>is OW-CPA</strong> secure.</p></li>

<li><p><strong>Counter Mode (CTR):</strong> the IV is increased for every block, therefore insertion/deletion is not possible as all following decryptions will be invalid.
<figure><img src="/images/IN4191/CTR.png" alt="CTR Operation"></figure>
this <strong>is IND-CPA</strong> secure and it allows for parallel computations.</p></li>
</ul>

<p>Overall security for the different modes:</p>

<p><figure><img src="/images/IN4191/MO_OW_Security.png" alt="Modes of Operations OW Security"></figure></p>

<p><figure><img src="/images/IN4191/MO_IND_Security.png" alt="Modes of Operation IND Security"></figure></p>

<h4 id="obtaining-chosen-ciphertext-security">Obtaining Chosen Ciphertext Security</h4>

<p>All previous modes of operations are not CCA secure (the decryption oracle would decrypt any old message), in order to achieve this security we need to use authentication encryption modes.</p>

<ul>
<li><p><strong>Encrypt then MAC:</strong> append a message authentication code to the ciphertext. This is done by
<figure><img src="/images/IN4191/MAC.png" alt="MAC"></figure>
and the message authentication code is applied to the ciphertext. This <strong>is IND-CCA secure</strong>.</p></li>

<li><p><strong>Encrypt and MAC:</strong> works in a similar way except the encryption is done on the ciphertext (not the plaintext). This is <strong>not IND-CPA</strong> secure.</p></li>

<li><p><strong>MAC then Encrypt:</strong> MAC the plaintext and then encrypt the MAC and the plaintext together.  With a deterministic MAC it is <strong>not IND-CPA</strong> secure.</p></li>
</ul>

        <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      </div>
    </article>
    
    <hr />

    <div class="post-info">
      
      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        1609 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2021-01-10
        

         
          
        
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://nicktehrany.github.io/in4191-security-and-cryptography-notes/lecture-7/">
                <span class="button__icon">←</span>
                <span class="button__text">Lecture 7: Hash Functions, MAC, and Key Derivation Functions</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="https://nicktehrany.github.io/in4191-security-and-cryptography-notes/lecture-5/">
                <span class="button__text">Lecture 5: Modern Stream Ciphers</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

  </main>
  
            </div>

            
                <footer class="footer">
    <div>
            <div>
                &nbsp; <a href="https://github.com/nicktehrany" target="_blank" rel="noopener" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a> &nbsp;&nbsp; <a href="https://www.linkedin.com/in/nicktehrany/" target="_blank" rel="noopener" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a> &nbsp;
            </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Theme created by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
    
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.28499481978221c4b835b9371cf490e7511775ef1b1d0aa73faf6f4dff18ea62355cd43681da19dd1e1e4081b9cb5d70d9472d958439cc15c60203b462f67532.js" integrity="sha512-KEmUgZeCIcS4Nbk3HPSQ51EXde8bHQqnP69vTf8Y6mI1XNQ2gdoZ3R4eQIG5y11w2UctlYQ5zBXGAgO0YvZ1Mg=="></script>



    </body>
</html>
